<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Buyer Stakeholders Workshop</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Raleway:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Open Sans', 'Raleway', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #fafafa;
            margin: 0;
            padding: 0;
        }
        .laptop-textarea {
            min-height: 80px;
            max-height: 120px;
            transition: max-height 0.3s ease;
            resize: none;
        }
        .laptop-textarea:focus {
            max-height: 200px;
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .step-icon {
            width: 48px;
            height: 48px;
            background-color: #FF9000;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            flex-shrink: 0;
        }
        input::placeholder {
            color: #9CA3AF;
        }
        @media (max-width: 768px) {
            .fields-grid {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Test Data from TODO.md specifications -->
    <script type="application/json" id="testData">
    {
        "selectedBuyingJobs": ["Consensus Creation", "Validation", "Supplier Selection"],
        "jobJustifications": {
            "Consensus Creation": "This is the hardest part because the purchase involves three departments (Engineering, Finance, Security) with conflicting priorities and budgets. Getting them all to agree on a timeline is where our deals stall the most.",
            "Validation": "Our champions struggle to prove the ROI of a *predictive* tool versus their 'good enough' reactive tools. They need concrete proof that our solution will work in their specific environment before going to the CFO.",
            "Supplier Selection": "The customer often defaults to just expanding their contract with an incumbent like Datadog, even if it doesn't solve the core problem, because it's the path of least resistance internally."
        },
        "buyingGroupType": "Type4",
        "stakeholders": [
            {
                "functionalRole": "Head of DevOps",
                "commonTitles": "Lead DevOps Engineer, Senior SRE",
                "buyingRole": "End User",
                "keyGoals": "Reduce time spent firefighting reactive alerts. Prevent being woken up at 2 AM for P1 incidents. Improve system reliability and automate manual toil.",
                "challenges": "Constantly pulled away from strategic projects to fix outages. Alert fatigue from current tools is high. Lacks the ability to get ahead of problems before they impact customers.",
                "enablementArtifact": "Create a '2-week POC guide' showing how to set up POSH AMP in their staging environment to demonstrate predictive alerting on their actual data without disrupting production systems."
            },
            {
                "functionalRole": "VP of Engineering",
                "commonTitles": "VP of Engineering, CTO, Head of Platform",
                "buyingRole": "Decision Maker",
                "keyGoals": "Improve team efficiency and focus on innovation. Link engineering reliability metrics (MTTR, MTBF) to business outcomes. Implement a resilient and scalable system architecture.",
                "challenges": "High operational costs due to engineering time spent on reactive problem-solving. Fragmented visibility across different platforms. Difficulty proving the business value of new infrastructure investments.",
                "enablementArtifact": "Engineering Efficiency Report template showing before/after metrics: time saved per engineer, reduction in P1 incidents, and correlation between system reliability and feature delivery velocity."
            },
            {
                "functionalRole": "Chief Financial Officer",
                "commonTitles": "CFO, VP of Finance",
                "buyingRole": "Economic Buyer",
                "keyGoals": "Justify all technology spend with clear ROI. Reduce financial risk associated with costly downtime. Ensure budget predictability and achieve cost savings.",
                "challenges": "API downtime is expensive ($100k+/hr), but it's a reactive, unpredictable cost. It's difficult to approve a new, proactive expense without a clear financial case showing it's cheaper than the current pain.",
                "enablementArtifact": "1-page ROI calculator with their actual downtime costs from last 6 months, showing 6-month payback period and projected 3-year savings of $2.1M in prevented outages and engineering efficiency."
            },
            {
                "functionalRole": "Director of IT Security",
                "commonTitles": "Director of Security, CISO",
                "buyingRole": "Blocker",
                "keyGoals": "Ensure all new vendors are SOC2 compliant. Prevent new tools from introducing security vulnerabilities. Maintain data integrity and governance all systems.",
                "challenges": "Every new tool is a potential security risk. The vendor onboarding process is long and requires extensive documentation on data handling, security, and compliance.",
                "enablementArtifact": "Security & Compliance packet: SOC2 Type II report, data processing agreement, technical brief on minimal read-only access requirements, and compliance roadmap showing GDPR/CCPA readiness."
            }
        ],
        "currentStep": 3
    }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // Global constants and helper functions
        const WORKSHOP_STORAGE_KEY = 'workshopState_buyer_stakeholders';

        /**
         * Loads the entire workshop state from localStorage using a specific key.
         * @param {string} storageKey - The unique key for the workshop's state.
         * @returns {object} The parsed workshop state or an empty object.
         */
        const loadWorkshopState = (storageKey) => {
            try {
                const savedState = localStorage.getItem(storageKey);
                return savedState ? JSON.parse(savedState) : {};
            } catch (error) {
                console.error("Could not load state from localStorage", error);
                return {};
            }
        };

        /**
         * Saves a piece of state by merging it into the existing workshop state.
         * @param {object} stateToSave - An object containing the key-value pairs to save.
         * @param {string} storageKey - The unique key for the workshop's state.
         */
        const saveWorkshopState = (stateToSave, storageKey) => {
            try {
                const currentState = loadWorkshopState(storageKey);
                const newState = { ...currentState, ...stateToSave };
                localStorage.setItem(storageKey, JSON.stringify(newState));
            } catch (error) {
                console.error("Could not save state to localStorage", error);
            }
        };

        // Helper function for word count feedback
        const WordCountFeedback = ({ text, minWords = 5 }) => {
            const wordCount = text.trim().split(/\s+/).filter(w => w.length > 0).length;
            const isValid = wordCount >= minWords;
            
            return (
                <div className="flex justify-between items-center mt-1">
                    <span className="text-xs text-gray-500">
                        (describe in {minWords}+ words)
                    </span>
                    <span className={`text-sm flex items-center gap-1 ${isValid ? 'text-green-600' : 'text-gray-500'}`}>
                        {wordCount} words
                        {isValid && <span>✓</span>}
                    </span>
                </div>
            );
        };

        const PrivacyNote = () => (
            <div className="bg-blue-50 border border-blue-200 text-blue-800 text-xs rounded-lg p-3 my-4">
                <p>
                    <strong>Note:</strong> Your progress is automatically saved in this browser's local storage. This data is private to your computer and is not sent to any server.
                </p>
            </div>
        );

        // StepIndicator component with completion status
        const StepIndicator = ({ currentStep, activity1Complete, activity2Complete, activity3Complete }) => {
            const steps = [
                { number: 1, title: "Map Buying Jobs", desc: "Identify the most difficult buying jobs", complete: activity1Complete },
                { number: 2, title: "Assign Personas", desc: "Map stakeholders to roles", complete: activity2Complete },
                { number: 3, title: "Assemble Your Map", desc: "Create buyer prescriptions", complete: activity3Complete }
            ];

            return (
                <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                    <div className="flex justify-between items-center">
                        {steps.map((step, index) => (
                            <React.Fragment key={step.number}>
                                <div className="flex items-center">
                                    <div className={`step-icon ${
                                        step.complete ? 'bg-green-500' : 
                                        currentStep >= step.number ? 'bg-orange-500' : 'bg-gray-400'
                                    }`}>
                                        {step.complete ? '✓' : step.number}
                                    </div>
                                    <div className="ml-3">
                                        <p className="text-sm font-medium text-gray-900">{step.title}</p>
                                        <p className="text-xs text-gray-500">{step.desc}</p>
                                    </div>
                                </div>
                                {index < steps.length - 1 && (
                                    <div className="flex-1 mx-4 h-px bg-gray-300"></div>
                                )}
                            </React.Fragment>
                        ))}
                    </div>
                </div>
            );
        };

        const StakeholderMapWorkshop = () => {
            // Navigation state
            const [currentStep, setCurrentStep] = useState(() => {
                const urlStep = new URLSearchParams(window.location.search).get('step');
                if (urlStep && [1, 2, 3].includes(parseInt(urlStep))) {
                    return parseInt(urlStep);
                }
                const saved = loadWorkshopState(WORKSHOP_STORAGE_KEY);
                return saved.currentStep || 1;
            });

            // Dev mode functionality
            const [devMode, setDevMode] = useState(false);
            const [devFillLoading, setDevFillLoading] = useState(false);
            const [glossaryOpen, setGlossaryOpen] = useState(false);
            const [jobsGlossaryOpen, setJobsGlossaryOpen] = useState(false);

            // Toggle dev mode
            const toggleDevMode = () => {
                setDevMode(!devMode);
                console.log(devMode ? '🔒 Dev mode disabled' : '🔓 Dev mode enabled');
            };

            // Load test data
            const devFillData = () => {
                setDevFillLoading(true);
                try {
                    const testData = JSON.parse(document.getElementById('testData').textContent);
                    
                    // Activity 1 state variables
                    setSelectedBuyingJobs(testData.selectedBuyingJobs || []);
                    setJobJustifications(testData.jobJustifications || {});
                    
                    // Activity 2 state variables
                    setBuyingGroupType(testData.buyingGroupType || 'Type3');
                    
                    // Load stakeholders and add enablementArtifact from testData if not present
                    const loadedStakeholders = testData.stakeholders || [];
                    const stakeholdersWithArtifacts = loadedStakeholders.map(s => ({
                        ...s,
                        enablementArtifact: s.enablementArtifact || ''
                    }));
                    setStakeholders(stakeholdersWithArtifacts);
                    
                    // Set current step
                    setCurrentStep(testData.currentStep || 3);
                    
                    console.log('✅ Dev data loaded successfully');
                } catch (error) {
                    console.error('❌ Failed to load dev data:', error);
                } finally {
                    setDevFillLoading(false);
                }
            };

            // Initialize all state variables from localStorage
            const savedState = loadWorkshopState(WORKSHOP_STORAGE_KEY);
            
            // Activity 1: Map the Buying Jobs
            const [selectedBuyingJobs, setSelectedBuyingJobs] = useState(savedState.selectedBuyingJobs || []);
            const [jobJustifications, setJobJustifications] = useState(savedState.jobJustifications || {});
            
            // Activity 2: Assign Personas to Roles (Dynamic array of stakeholders)
            const [buyingGroupType, setBuyingGroupType] = useState(savedState.buyingGroupType || 'Type3');
            
            // Pre-populate with required stakeholders if empty
            const getInitialStakeholders = () => {
                // Check if we have saved stakeholders with actual data
                if (savedState.stakeholders && 
                    Array.isArray(savedState.stakeholders) && 
                    savedState.stakeholders.length > 0) {
                    return savedState.stakeholders;
                }
                // Pre-populate with 3 required buying roles for new users
                return [
                    {
                        functionalRole: '',
                        commonTitles: '',
                        buyingRole: 'Decision Maker',
                        keyGoals: '',
                        challenges: '',
                        enablementArtifact: ''
                    },
                    {
                        functionalRole: '',
                        commonTitles: '',
                        buyingRole: 'Economic Buyer',
                        keyGoals: '',
                        challenges: '',
                        enablementArtifact: ''
                    },
                    {
                        functionalRole: '',
                        commonTitles: '',
                        buyingRole: 'End User',
                        keyGoals: '',
                        challenges: '',
                        enablementArtifact: ''
                    }
                ];
            };
            
            const [stakeholders, setStakeholders] = useState(getInitialStakeholders());

            // Dynamic minimum stakeholder calculation based on buying group type
            const minStakeholders = useMemo(() => {
                if (buyingGroupType === 'Type1') return 1;
                if (buyingGroupType === 'Type2') return 2;
                return 3; // Type3 and Type4 both require 3+
            }, [buyingGroupType]);

            // Dynamic help text based on buying group type
            const stakeholderHelpText = useMemo(() => {
                const helpTexts = {
                    Type1: 'Map your single key player. In this model, one person holds all the key roles.',
                    Type2: 'Map at least 2 key players in the buying committee.',
                    Type3: 'Map at least 3 key players in the buying committee.',
                    Type4: 'Map at least 3-5 key players in the buying committee.'
                };
                return helpTexts[buyingGroupType] || helpTexts.Type3;
            }, [buyingGroupType]);

            // Activity completion logic
            const activity1Complete = useMemo(() => {
                return selectedBuyingJobs.length >= 2 && selectedBuyingJobs.length <= 3 && 
                       selectedBuyingJobs.every(job => {
                           const justification = jobJustifications[job] || '';
                           return justification.trim().split(/\s+/).filter(w => w.length > 0).length >= 5;
                       });
            }, [selectedBuyingJobs, jobJustifications]);
            
            const activity2Complete = useMemo(() => {
                return stakeholders.length >= minStakeholders && stakeholders.every(s => 
                    s.functionalRole && s.functionalRole.trim().split(/\s+/).filter(w => w.length > 0).length >= 3 &&
                    s.commonTitles && s.commonTitles.trim().split(/\s+/).filter(w => w.length > 0).length >= 2 &&
                    s.buyingRole &&
                    s.keyGoals && s.keyGoals.trim().split(/\s+/).filter(w => w.length > 0).length >= 5 &&
                    s.challenges && s.challenges.trim().split(/\s+/).filter(w => w.length > 0).length >= 5
                );
            }, [stakeholders, minStakeholders]);
            
            const activity3Complete = useMemo(() => {
                const stakeholdersWithArtifacts = stakeholders.filter(s => {
                    if (!s.enablementArtifact || !s.enablementArtifact.trim()) return false;
                    const wordCount = s.enablementArtifact.trim().split(/\s+/).filter(w => w.length > 0).length;
                    return wordCount >= 10;
                });
                console.log('Activity 3 validation:', {
                    totalStakeholders: stakeholders.length,
                    stakeholdersWithArtifacts: stakeholdersWithArtifacts.length,
                    artifactWordCounts: stakeholders.map((s, i) => ({
                        index: i,
                        wordCount: s.enablementArtifact ? s.enablementArtifact.trim().split(/\s+/).filter(w => w.length > 0).length : 0
                    }))
                });
                return stakeholdersWithArtifacts.length >= 2;
            }, [stakeholders]);

            // Auto-save state to localStorage whenever any form data changes
            useEffect(() => {
                const currentState = {
                    selectedBuyingJobs,
                    jobJustifications,
                    buyingGroupType,
                    stakeholders,
                    currentStep
                };
                saveWorkshopState(currentState, WORKSHOP_STORAGE_KEY);
            }, [selectedBuyingJobs, jobJustifications, buyingGroupType, stakeholders, currentStep]);

            // Navigation functions
            const goToNextStep = () => {
                const nextStep = Math.min(currentStep + 1, 3);
                setCurrentStep(nextStep);
                saveWorkshopState({ currentStep: nextStep }, WORKSHOP_STORAGE_KEY);
            };

            const goToPreviousStep = () => {
                const prevStep = Math.max(currentStep - 1, 1);
                setCurrentStep(prevStep);
                saveWorkshopState({ currentStep: prevStep }, WORKSHOP_STORAGE_KEY);
            };

            const resetAllActivities = () => {
                if (confirm('Are you sure you want to reset all your progress? This cannot be undone.')) {
                    // Clear component state
                    setSelectedBuyingJobs([]);
                    setJobJustifications({});
                    setBuyingGroupType('Type3');
                    setStakeholders([]);
                    setCurrentStep(1);
                    
                    // Clear localStorage data
                    const emptyState = {
                        selectedBuyingJobs: [],
                        jobJustifications: {},
                        buyingGroupType: 'Type3',
                        stakeholders: [],
                        currentStep: 1
                    };
                    saveWorkshopState(emptyState, WORKSHOP_STORAGE_KEY);
                }
            };

            return (
                <div className="bg-gray-50 min-h-screen">
                    <div className="max-w-[900px] mx-auto p-4">
                        {/* Header */}
                        <div className="flex justify-between items-center w-full mb-2">
                            <a href="index.html" className="text-orange-500 hover:text-orange-600">← Back to Workshop</a>
                            <a href="../index.html" className="text-orange-500 hover:text-orange-600">All GTM Workshops ↑</a>
                        </div>

                        {/* Title with dev mode toggle */}
                        <h1 
                            className={`text-xl font-bold text-gray-800 ${devMode ? 'text-orange-600' : ''} cursor-pointer select-none mb-4`}
                            onDoubleClick={toggleDevMode}
                            title="Double-click to toggle dev mode"
                        >
                            Map Buyer Stakeholders Workshop {devMode && '🔧'}
                        </h1>

                        {/* Dev mode controls */}
                        {devMode && (
                            <div className="mt-3 pt-3 border-t border-orange-200 mb-4">
                                <div className="flex items-center justify-between">
                                    <span className="text-xs text-orange-600 font-medium">🔧 Dev Mode Active</span>
                                    <button
                                        onClick={devFillData}
                                        disabled={devFillLoading}
                                        className="bg-orange-500 text-white px-3 py-1 rounded text-xs hover:bg-orange-600"
                                    >
                                        {devFillLoading ? '⏳ Loading...' : '📝 Fill Test Data'}
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Step Indicator */}
                        <StepIndicator 
                            currentStep={currentStep}
                            activity1Complete={activity1Complete}
                            activity2Complete={activity2Complete}
                            activity3Complete={activity3Complete}
                        />

                        <PrivacyNote />

                        {/* Activity Content */}
                        <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                            {currentStep === 1 && (
                                <div className="animate-fadeIn">
                                    <h2 className="text-xl font-bold text-gray-800 mb-4">
                                        Activity 1: Map the Buying Jobs
                                    </h2>
                                    <p className="text-gray-600 mb-4">
                                        The B2B buying process isn't a linear funnel; it's a journey where customers complete six distinct 'jobs' to make a decision. Your task is to identify the 2-3 jobs that create the most friction for your customer.
                                    </p>
                                    <p className="text-gray-600 mb-6">
                                        This crucial first step helps you see the deal from their perspective and pinpoint exactly where your sales process can add the most value.
                                    </p>
                                    
                                    <div className="border-t border-b border-gray-200 py-3 my-6">
                                        <button
                                            onClick={() => setJobsGlossaryOpen(!jobsGlossaryOpen)}
                                            className="w-full flex justify-between items-center text-base font-bold text-gray-800 hover:text-gray-900"
                                        >
                                            <span>View Buying Job Definitions</span>
                                            <span className={`transform transition-transform ${jobsGlossaryOpen ? 'rotate-180' : ''}`}>▼</span>
                                        </button>
                                        {jobsGlossaryOpen && (
                                            <div className="mt-4 pl-4 border-l-2 border-orange-500 text-sm text-gray-600 space-y-3">
                                                <p><strong>Problem Identification:</strong> The buyer realizes, "We need to do something."</p>
                                                <p><strong>Solution Exploration:</strong> The buyer asks, "What's out there to solve our problem?"</p>
                                                <p><strong>Requirements Building:</strong> The buyer determines, "What exactly do we need the purchase to do?"</p>
                                                <p><strong>Supplier Selection:</strong> The buyer asks, "Does this specific solution do what we want it to do?"</p>
                                                <p><strong>Validation:</strong> The buyer confirms, "We think we know the right answer, but we need to be sure."</p>
                                                <p><strong>Consensus Creation:</strong> The buyer concludes, "We need to get everyone on board with this decision."</p>
                                            </div>
                                        )}
                                    </div>
                                    
                                    {/* Buying Jobs Selection */}
                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-gray-700 mb-3">
                                            Select the top 2-3 most difficult buying jobs:
                                            <span className="text-red-500">*</span>
                                        </label>
                                        <p className="text-xs text-gray-500 mb-4">Choose the jobs where your customer's buying process most often stalls or breaks down.</p>
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                            {[
                                                { name: 'Problem Identification', tooltip: "The buyer's thought: 'We need to do something.'" },
                                                { name: 'Solution Exploration', tooltip: "The buyer's thought: 'What's out there to solve our problem?'" }, 
                                                { name: 'Requirements Building', tooltip: "The buyer's thought: 'What exactly do we need the purchase to do?'" },
                                                { name: 'Supplier Selection', tooltip: "The buyer's thought: 'Does this do what we want it to do?'" },
                                                { name: 'Validation', tooltip: "The buyer's thought: 'We think we know the right answer, but we need to be sure.'" },
                                                { name: 'Consensus Creation', tooltip: "The buyer's thought: 'We need to get everyone on board.'" }
                                            ].map((job) => (
                                                <div key={job.name} className="flex items-center">
                                                    <input
                                                        type="checkbox"
                                                        id={job.name}
                                                        checked={selectedBuyingJobs.includes(job.name)}
                                                        onChange={(e) => {
                                                            if (e.target.checked) {
                                                                if (selectedBuyingJobs.length < 3) {
                                                                    setSelectedBuyingJobs([...selectedBuyingJobs, job.name]);
                                                                }
                                                            } else {
                                                                setSelectedBuyingJobs(selectedBuyingJobs.filter(j => j !== job.name));
                                                            }
                                                        }}
                                                        className="h-4 w-4 text-orange-500 focus:ring-orange-500 border-gray-300 rounded"
                                                        disabled={!selectedBuyingJobs.includes(job.name) && selectedBuyingJobs.length >= 3}
                                                    />
                                                    <label htmlFor={job.name} className="ml-2 text-sm text-gray-700 flex items-center">
                                                        {job.name}
                                                        <span 
                                                            className="ml-1 text-xs text-gray-400 cursor-help" 
                                                            title={job.tooltip}
                                                        >
                                                            (?)
                                                        </span>
                                                    </label>
                                                </div>
                                            ))}
                                        </div>
                                        
                                        <div className="mt-2 text-sm">
                                            <span className={selectedBuyingJobs.length >= 2 && selectedBuyingJobs.length <= 3 ? 'text-green-600' : 'text-gray-500'}>
                                                {selectedBuyingJobs.length} of 2-3 selected
                                                {selectedBuyingJobs.length >= 2 && selectedBuyingJobs.length <= 3 && <span className="ml-1">✓</span>}
                                            </span>
                                        </div>
                                    </div>

                                    {/* Individual Job Justifications */}
                                    {selectedBuyingJobs.length > 0 && (
                                        <div className="mb-6">
                                            <h3 className="text-lg font-medium text-gray-800 mb-4">
                                                Explain Each Difficult Job
                                            </h3>
                                            <p className="text-xs text-gray-500 mb-4">
                                                For each selected buying job, explain why it's particularly difficult for your customer.
                                            </p>
                                            
                                            {selectedBuyingJobs.map((job, index) => (
                                                <div key={job} className="mb-4">
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        Why is <strong>{job}</strong> a difficult job for your customer?
                                                        <span className="text-red-500">*</span>
                                                    </label>
                                                    <textarea
                                                        value={jobJustifications[job] || ''}
                                                        onChange={(e) => {
                                                            setJobJustifications(prev => ({
                                                                ...prev,
                                                                [job]: e.target.value
                                                            }));
                                                        }}
                                                        placeholder={`e.g., Our customers struggle with ${job} because...`}
                                                        className="laptop-textarea w-full p-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none"
                                                    />
                                                    <WordCountFeedback text={jobJustifications[job] || ''} minWords={5} />
                                                </div>
                                            ))}
                                            
                                            <p className="text-xs text-gray-500 mt-2">
                                                Think about where your deals get stuck. Is it identifying the problem, or getting 10 stakeholders to agree? This is the friction your sales process must solve.
                                            </p>
                                        </div>
                                    )}
                                </div>
                            )}

                            {currentStep === 2 && (
                                <div className="animate-fadeIn">
                                    <h2 className="text-xl font-bold text-gray-800 mb-4">
                                        Activity 2: Assign Personas to Roles
                                    </h2>
                                    
                                    <div className="bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6">
                                        <h3 className="text-sm font-semibold text-amber-800 mb-2">Context from Activity 1: The Most Difficult Buying Jobs</h3>
                                        <ul className="list-disc list-inside">
                                            {selectedBuyingJobs.map(job => (
                                                <li key={job} className="text-sm text-amber-700">{job}</li>
                                            ))}
                                        </ul>
                                        <p className="text-xs text-amber-700 mt-3">
                                            Keep these difficult jobs in mind as you map each stakeholder. How do these challenges shape their individual goals and motivations?
                                        </p>
                                    </div>

                                    {/* Buying Group Type Selection */}
                                    <div className="mb-6 p-4 border rounded-lg bg-gray-50">
                                        <label className="block text-sm font-medium text-gray-700 mb-3">
                                            First, select the Buying Group Type that best matches your current sales motion:
                                        </label>
                                        <div className="space-y-3">
                                            {/* Type 1 Option */}
                                            <div className="flex items-start">
                                                <input 
                                                    id="type1" 
                                                    name="buyingGroupType" 
                                                    type="radio" 
                                                    value="Type1" 
                                                    checked={buyingGroupType === 'Type1'} 
                                                    onChange={(e) => setBuyingGroupType(e.target.value)} 
                                                    className="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500 mt-1"
                                                />
                                                <div className="ml-3 text-sm">
                                                    <label htmlFor="type1" className="font-medium text-gray-900">Type 1: Singular</label>
                                                    <p className="text-gray-500">One person holds all roles (User, Buyer, Decision Maker). Common for PLG or in very small companies.</p>
                                                </div>
                                            </div>
                                            {/* Type 2 Option */}
                                            <div className="flex items-start">
                                                <input 
                                                    id="type2" 
                                                    name="buyingGroupType" 
                                                    type="radio" 
                                                    value="Type2" 
                                                    checked={buyingGroupType === 'Type2'} 
                                                    onChange={(e) => setBuyingGroupType(e.target.value)} 
                                                    className="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500 mt-1"
                                                />
                                                <div className="ml-3 text-sm">
                                                    <label htmlFor="type2" className="font-medium text-gray-900">Type 2: Limited Multi-Role</label>
                                                    <p className="text-gray-500">Two people are involved (e.g., a manager as the Buyer/Decision Maker and an employee as the End User).</p>
                                                </div>
                                            </div>
                                            {/* Type 3 Option */}
                                            <div className="flex items-start">
                                                <input 
                                                    id="type3" 
                                                    name="buyingGroupType" 
                                                    type="radio" 
                                                    value="Type3" 
                                                    checked={buyingGroupType === 'Type3'} 
                                                    onChange={(e) => setBuyingGroupType(e.target.value)} 
                                                    className="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500 mt-1"
                                                />
                                                <div className="ml-3 text-sm">
                                                    <label htmlFor="type3" className="font-medium text-gray-900">Type 3: Diversified (Within Dept)</label>
                                                    <p className="text-gray-500">At least three distinct roles (e.g., End User, Economic Buyer, Decision Maker) exist within the same department.</p>
                                                </div>
                                            </div>
                                            {/* Type 4 Option */}
                                            <div className="flex items-start">
                                                <input 
                                                    id="type4" 
                                                    name="buyingGroupType" 
                                                    type="radio" 
                                                    value="Type4" 
                                                    checked={buyingGroupType === 'Type4'} 
                                                    onChange={(e) => setBuyingGroupType(e.target.value)} 
                                                    className="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500 mt-1"
                                                />
                                                <div className="ml-3 text-sm">
                                                    <label htmlFor="type4" className="font-medium text-gray-900">Type 4: Cross-Departmental</label>
                                                    <p className="text-gray-500">The buying group involves multiple departments (e.g., Engineering, Finance, Legal) and is highly complex.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <p className="text-gray-600 mb-4">
                                        You are never selling to just one person; you're selling to a committee with diverse motivations. This activity moves beyond org charts to build a true stakeholder map.
                                    </p>
                                    <p className="text-gray-600 mb-6">
                                        Your task is to identify the key players and define their functional role, buying role (e.g., Champion, Blocker), and the specific goals and challenges that drive their decisions.
                                    </p>
                                    
                                    <div className="border-t border-b border-gray-200 py-3 my-6">
                                        <button
                                            onClick={() => setGlossaryOpen(!glossaryOpen)}
                                            className="w-full flex justify-between items-center text-base font-bold text-gray-800 hover:text-gray-900"
                                        >
                                            <span>View Buying Role Definitions</span>
                                            <span className={`transform transition-transform ${glossaryOpen ? 'rotate-180' : ''}`}>▼</span>
                                        </button>
                                        {glossaryOpen && (
                                            <div className="mt-4 pl-4 border-l-2 border-orange-500 text-sm text-gray-600 space-y-3">
                                                <p><strong>Champion:</strong> An internal advocate who actively promotes your solution and has a vested interest in its success.</p>
                                                <p><strong>Economic Buyer:</strong> The person who owns the budget and provides the final financial sign-off for the purchase.</p>
                                                <p><strong>Technical Buyer:</strong> Evaluates the solution for technical fit, security, integrations, and operational compatibility.</p>
                                                <p><strong>Decision Maker:</strong> The individual with the ultimate authority to make the final "yes" or "no" purchasing decision.</p>
                                                <p><strong>End User:</strong> The person or team who will use your product day-to-day. Their practical feedback heavily influences the decision.</p>
                                                <p><strong>Blocker:</strong> An individual who can stop or significantly delay the sales process due to budget concerns, technical reservations, or other objections.</p>
                                                <p><strong>Influencer:</strong> A person who can influence the decision based on their expertise, relationships, or credibility, even without formal authority.</p>
                                            </div>
                                        )}
                                    </div>
                                    
                                    {/* Stakeholders Array */}
                                    <div className="mb-6">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-lg font-medium text-gray-800">
                                                Key Stakeholders Mapped: ({stakeholders.length} of {minStakeholders}+)
                                                <span className="text-red-500">*</span>
                                            </h3>
                                            <button
                                                onClick={() => {
                                                    const newStakeholder = {
                                                        functionalRole: '',
                                                        commonTitles: '',
                                                        buyingRole: '',
                                                        keyGoals: '',
                                                        challenges: '',
                                                        enablementArtifact: ''
                                                    };
                                                    setStakeholders([...stakeholders, newStakeholder]);
                                                }}
                                                className="bg-orange-500 text-white px-3 py-1 text-sm rounded-lg hover:bg-orange-600 transition-colors"
                                            >
                                                + Add Stakeholder
                                            </button>
                                        </div>
                                        
                                        <p className="text-xs text-gray-500 mb-2">{stakeholderHelpText}</p>
                                        <p className="text-xs text-blue-600 bg-blue-50 p-2 rounded mb-4">
                                            <strong>Note:</strong> The minimum 3 stakeholders required are: Decision Maker, Economic Buyer, and End User. 
                                            These critical buying roles are pre-populated below. You may add additional stakeholders as needed.
                                        </p>
                                        
                                        {/* Table format for stakeholder entry */}
                                        <div className="overflow-x-auto">
                                            <table className="min-w-full divide-y divide-gray-200">
                                                <thead className="bg-gray-50">
                                                    <tr>
                                                        <th className="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            #
                                                        </th>
                                                        <th className="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            Functional Role*
                                                            <span 
                                                                className="ml-1 text-gray-400 cursor-help normal-case" 
                                                                title="Describe the person's job function and level of seniority, not just their title. e.g., 'Head of Platform Engineering' or 'Senior DevOps Lead'."
                                                            >
                                                                (?)
                                                            </span>
                                                        </th>
                                                        <th className="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            Common Titles*
                                                            <span 
                                                                className="ml-1 text-gray-400 cursor-help normal-case" 
                                                                title="The specific job titles this person might have in your target accounts. This helps with prospecting on platforms like LinkedIn."
                                                            >
                                                                (?)
                                                            </span>
                                                        </th>
                                                        <th className="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            Buying Role*
                                                            <span 
                                                                className="ml-1 text-gray-400 cursor-help normal-case" 
                                                                title="This is the role they play in THIS specific deal. A 'VP of Engineering' could be a 'Decision Maker' in one deal and a 'Blocker' in another if they prefer a competitor."
                                                            >
                                                                (?)
                                                            </span>
                                                        </th>
                                                        <th className="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            Key Goals & Motivations*
                                                            <span 
                                                                className="ml-1 text-gray-400 cursor-help normal-case" 
                                                                title="What does this person need to achieve to be successful in their job? Think about their KPIs. e.g., A CFO is motivated by ROI and cost savings; a DevOps engineer is motivated by uptime and reducing manual work."
                                                            >
                                                                (?)
                                                            </span>
                                                        </th>
                                                        <th className="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            Challenges & Pains*
                                                            <span 
                                                                className="ml-1 text-gray-400 cursor-help normal-case" 
                                                                title="What specific problems are preventing them from achieving their goals? Use quantifiable pain where possible. e.g., 'Spends 10+ hours per week on manual troubleshooting' or 'Loses $100k in revenue for every hour of API downtime'."
                                                            >
                                                                (?)
                                                            </span>
                                                        </th>
                                                        <th className="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            Actions
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody className="bg-white divide-y divide-gray-200">
                                                    {stakeholders.map((stakeholder, index) => (
                                                        <tr key={index}>
                                                            <td className="px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                                {index + 1}
                                                                {index < 3 && <span className="text-xs text-gray-500 ml-1">(Req)</span>}
                                                            </td>
                                                            <td className="px-3 py-4 text-sm text-gray-500">
                                                                <input
                                                                    type="text"
                                                                    value={stakeholder.functionalRole}
                                                                    onChange={(e) => {
                                                                        const updated = [...stakeholders];
                                                                        updated[index].functionalRole = e.target.value;
                                                                        setStakeholders(updated);
                                                                    }}
                                                                    placeholder="e.g., Head of DevOps"
                                                                    className="w-full min-w-[140px] p-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-orange-500 focus:border-orange-500"
                                                                />
                                                            </td>
                                                            <td className="px-3 py-4 text-sm text-gray-500">
                                                                <input
                                                                    type="text"
                                                                    value={stakeholder.commonTitles}
                                                                    onChange={(e) => {
                                                                        const updated = [...stakeholders];
                                                                        updated[index].commonTitles = e.target.value;
                                                                        setStakeholders(updated);
                                                                    }}
                                                                    placeholder="e.g., VP of Engineering, CTO"
                                                                    className="w-full min-w-[140px] p-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-orange-500 focus:border-orange-500"
                                                                />
                                                            </td>
                                                            <td className="px-3 py-4 text-sm text-gray-500">
                                                                <select
                                                                    value={stakeholder.buyingRole}
                                                                    onChange={(e) => {
                                                                        const updated = [...stakeholders];
                                                                        updated[index].buyingRole = e.target.value;
                                                                        setStakeholders(updated);
                                                                    }}
                                                                    className="w-full min-w-[130px] p-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-orange-500 focus:border-orange-500"
                                                                    disabled={index < 3} // Disable for pre-populated roles
                                                                >
                                                                    <option value="">Select role...</option>
                                                                    <option value="Champion">Champion</option>
                                                                    <option value="Economic Buyer">Economic Buyer</option>
                                                                    <option value="Technical Buyer">Technical Buyer</option>
                                                                    <option value="Decision Maker">Decision Maker</option>
                                                                    <option value="End User">End User</option>
                                                                    <option value="Blocker">Blocker</option>
                                                                    <option value="Influencer">Influencer</option>
                                                                </select>
                                                            </td>
                                                            <td className="px-3 py-4 text-sm text-gray-500">
                                                                <textarea
                                                                    value={stakeholder.keyGoals}
                                                                    onChange={(e) => {
                                                                        const updated = [...stakeholders];
                                                                        updated[index].keyGoals = e.target.value;
                                                                        setStakeholders(updated);
                                                                    }}
                                                                    placeholder="e.g., Reduce P1 incidents by 50%"
                                                                    rows="2"
                                                                    className="w-full min-w-[180px] p-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-orange-500 focus:border-orange-500 resize-none"
                                                                />
                                                            </td>
                                                            <td className="px-3 py-4 text-sm text-gray-500">
                                                                <textarea
                                                                    value={stakeholder.challenges}
                                                                    onChange={(e) => {
                                                                        const updated = [...stakeholders];
                                                                        updated[index].challenges = e.target.value;
                                                                        setStakeholders(updated);
                                                                    }}
                                                                    placeholder="e.g., 10+ hours/week firefighting"
                                                                    rows="2"
                                                                    className="w-full min-w-[180px] p-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-orange-500 focus:border-orange-500 resize-none"
                                                                />
                                                            </td>
                                                            <td className="px-3 py-4 whitespace-nowrap text-sm font-medium">
                                                                {index >= 3 ? (
                                                                    <button
                                                                        onClick={() => {
                                                                            setStakeholders(stakeholders.filter((_, i) => i !== index));
                                                                        }}
                                                                        className="text-red-600 hover:text-red-900"
                                                                    >
                                                                        Remove
                                                                    </button>
                                                                ) : (
                                                                    <span className="text-gray-400">-</span>
                                                                )}
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        {stakeholders.length === 0 && (
                                            <div className="text-center py-8 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg">
                                                <p>No stakeholders added yet.</p>
                                                <p className="text-sm mt-1">Click "Add Stakeholder" to get started.</p>
                                            </div>
                                        )}
                                        
                                        {/* Add second Add Stakeholder button at bottom */}
                                        {stakeholders.length > 0 && (
                                            <div className="flex justify-center mt-4">
                                                <button
                                                    onClick={() => {
                                                        const newStakeholder = {
                                                            functionalRole: '',
                                                            commonTitles: '',
                                                            buyingRole: '',
                                                            keyGoals: '',
                                                            challenges: '',
                                                            enablementArtifact: ''
                                                        };
                                                        setStakeholders([...stakeholders, newStakeholder]);
                                                    }}
                                                    className="bg-orange-500 text-white px-3 py-1 text-sm rounded-lg hover:bg-orange-600 transition-colors"
                                                >
                                                    + Add Another Stakeholder
                                                </button>
                                            </div>
                                        )}
                                        
                                        <div className="mt-4 text-sm">
                                            <span className={stakeholders.length >= minStakeholders ? 'text-green-600' : 'text-red-500'}>
                                                {stakeholders.length} of {minStakeholders}+ stakeholders required
                                                {stakeholders.length >= minStakeholders && <span className="ml-1">✓</span>}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {currentStep === 3 && (
                                <div className="animate-fadeIn">
                                    <h2 className="text-xl font-bold text-gray-800 mb-4">
                                        Activity 3: Assemble Your Stakeholder Map
                                    </h2>
                                    <p className="text-gray-600 mb-4">
                                        This final activity brings everything together into a single, actionable stakeholder map. It synthesizes the stakeholder profiles from Activity 2 with a concrete plan to enable your champion.
                                    </p>
                                    <p className="text-gray-600 mb-6">
                                        For each key stakeholder, review the discovery questions that can help you validate your assumptions, and define the single most important "prescription"—a tool or piece of content—to help your champion win them over.
                                    </p>
                                    
                                    {/* Dynamic Stakeholder Map */}
                                    {stakeholders.length > 0 ? (
                                        <div className="mb-6">
                                            <h3 className="text-lg font-medium text-gray-800 mb-4">
                                                Your Complete Stakeholder Map
                                                <span className="text-red-500">*</span>
                                            </h3>
                                            <p className="text-xs text-gray-500 mb-4">
                                                Complete the enablement artifacts for at least 2 stakeholders. Scroll horizontally to see all columns.
                                            </p>
                                            
                                            {/* Horizontal-scrolling table */}
                                            <div className="overflow-x-auto border border-gray-200 rounded-lg">
                                                <table className="min-w-full text-sm text-left">
                                                    <thead className="bg-gray-50">
                                                        <tr>
                                                            <th scope="col" className="sticky left-0 bg-gray-50 px-3 py-3 font-semibold text-gray-900 w-48 z-10">Attribute</th>
                                                            {stakeholders.map((stakeholder, index) => (
                                                                <th key={index} scope="col" className="px-3 py-3 font-semibold text-gray-900 min-w-[280px]">
                                                                    {stakeholder.functionalRole || `Stakeholder ${index + 1}`}
                                                                </th>
                                                            ))}
                                                        </tr>
                                                    </thead>
                                                    <tbody className="bg-white">
                                                        {/* Row for Buying Role (Read-only) */}
                                                        <tr>
                                                            <td className="sticky left-0 bg-white px-3 py-4 font-medium text-gray-900 z-10">Buying Role</td>
                                                            {stakeholders.map((s, i) => (
                                                                <td key={i} className="px-3 py-4 text-gray-700 border-t">{s.buyingRole || 'Not set'}</td>
                                                            ))}
                                                        </tr>

                                                        {/* Row for Common Titles (Read-only) */}
                                                        <tr>
                                                            <td className="sticky left-0 bg-white px-3 py-4 font-medium text-gray-900 z-10">Common Titles</td>
                                                            {stakeholders.map((s, i) => (
                                                                <td key={i} className="px-3 py-4 text-gray-700 border-t">{s.commonTitles || 'Not set'}</td>
                                                            ))}
                                                        </tr>

                                                        {/* Row for Key Discovery Question (Dynamic & Read-only) */}
                                                        <tr>
                                                            <td className="sticky left-0 bg-white px-3 py-4 font-medium text-gray-900 z-10">Key Discovery Question</td>
                                                            {stakeholders.map((s, i) => {
                                                                const questionMap = {
                                                                    'Champion': 'Ask: "Who are the key people influencing this decision, both for and against?"',
                                                                    'Economic Buyer': 'Ask: "Who oversees the budget for this type of purchase?"',
                                                                    'Technical Buyer': 'Ask: "Who will evaluate the technical aspects and operational integration of this product/service?"',
                                                                    'Decision Maker': 'Ask: "Who has the final say in making this type of purchase?"',
                                                                    'End User': 'Ask: "Who will be the end-users of this product/service and what are their needs and feedback?"',
                                                                    'Blocker': 'Ask: "Who might have reservations about this product/service, or has veto power?"',
                                                                    'Influencer': 'Ask: "Besides the formal team, who else\'s opinion is important for this decision?"'
                                                                };
                                                                return (
                                                                    <td key={i} className="px-3 py-4 text-gray-700 border-t italic bg-gray-50">{questionMap[s.buyingRole] || 'N/A'}</td>
                                                                );
                                                            })}
                                                        </tr>

                                                        {/* Row for Enablement Artifact (Editable Textarea) */}
                                                        <tr className="align-top">
                                                            <td className="sticky left-0 bg-white px-3 py-4 font-medium text-gray-900 z-10">
                                                                Enablement Artifact <span className="text-red-500">*</span>
                                                                <p className="text-xs font-normal text-gray-500 mt-1">What asset will you give your champion to win this person over?</p>
                                                            </td>
                                                            {stakeholders.map((stakeholder, index) => (
                                                                <td key={index} className="px-3 py-4 border-t">
                                                                    <textarea
                                                                        value={stakeholder.enablementArtifact || ''}
                                                                        onChange={(e) => {
                                                                            const updated = [...stakeholders];
                                                                            updated[index].enablementArtifact = e.target.value;
                                                                            setStakeholders(updated);
                                                                        }}
                                                                        placeholder="e.g., ROI calculator, technical brief..."
                                                                        className="w-full h-32 p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                                                    />
                                                                    <WordCountFeedback text={stakeholder.enablementArtifact || ''} minWords={10} />
                                                                </td>
                                                            ))}
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            {/* Status indicator */}
                                            <div className="mt-4 text-sm">
                                                {(() => {
                                                    const completedCount = stakeholders.filter(s => 
                                                        s.enablementArtifact && s.enablementArtifact.trim().split(/\s+/).filter(w => w.length > 0).length >= 10
                                                    ).length;
                                                    return (
                                                        <span className={completedCount >= 2 ? 'text-green-600' : 'text-gray-500'}>
                                                            {completedCount} of 2+ stakeholders have enablement artifacts
                                                            {completedCount >= 2 && <span className="ml-1">✓</span>}
                                                        </span>
                                                    );
                                                })()}
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center py-8 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg">
                                            <p>No stakeholders available.</p>
                                            <p className="text-sm mt-1">Complete Activity 2 first to populate your stakeholder map.</p>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>

                        {/* Markdown Export - Show when workshop is complete */}
                        {activity1Complete && activity2Complete && activity3Complete && (
                            <div id="markdownExport" className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">
                                    📋 Your Buyer Stakeholder Map & Enablement Plan
                                </h2>
                                <p className="text-gray-600 mb-4">
                                    Congratulations! Your stakeholder mapping workshop is complete. Copy the summary below to share with your team or paste into Google Docs.
                                </p>
                                
                                <textarea
                                    id="markdownSummary"
                                    readOnly
                                    className="w-full h-64 text-sm p-3 font-mono border border-gray-200 rounded-lg bg-gray-50 resize-none mb-3"
                                    value={(() => {
                                        const buyingGroupTypeLabels = {
                                            Type1: 'Type 1: Singular',
                                            Type2: 'Type 2: Limited Multi-Role', 
                                            Type3: 'Type 3: Diversified (Within Dept)',
                                            Type4: 'Type 4: Cross-Departmental'
                                        };

                                        const questionMap = {
                                            'Champion': 'Ask: "Who are the key people influencing this decision, both for and against?"',
                                            'Economic Buyer': 'Ask: "Who oversees the budget for this type of purchase?"',
                                            'Technical Buyer': 'Ask: "Who will evaluate the technical aspects and operational integration of this product/service?"',
                                            'Decision Maker': 'Ask: "Who has the final say in making this type of purchase?"',
                                            'End User': 'Ask: "Who will be the end-users of this product/service and what are their needs and feedback?"',
                                            'Blocker': 'Ask: "Who might have reservations about this product/service, or has veto power?"',
                                            'Influencer': 'Ask: "Besides the formal team, who else\'s opinion is important for this decision?"'
                                        };

                                        let markdown = `# Complete Buyer Stakeholder Map

*This comprehensive stakeholder map combines buying job analysis, detailed stakeholder profiles, and enablement artifacts to arm your champion for success. Generated via the GTM Workshop.*

---

## 1. Critical Buying Jobs Analysis

**The ${selectedBuyingJobs.length} most difficult buying jobs for our customer are:**
${selectedBuyingJobs.map(job => `- ${job}`).join('\n')}

**Why These Jobs Are Most Difficult:**
${selectedBuyingJobs.map(job => `\n**${job}:** ${jobJustifications[job] || 'No justification provided'}`).join('')}

---

## 2. Complete Stakeholder Profiles

**Buying Group Type:** ${buyingGroupTypeLabels[buyingGroupType] || buyingGroupType}

`;

                                        stakeholders.forEach((stakeholder, index) => {
                                            const discoveryQuestion = questionMap[stakeholder.buyingRole] || 'Ask: "What role does this person play in purchasing decisions?"';
                                            
                                            markdown += `
### **Stakeholder ${index + 1}: ${stakeholder.functionalRole}**

| Attribute | Details |
| :--- | :--- |
| **Common Titles** | ${stakeholder.commonTitles || ''} |
| **Buying Role** | ${stakeholder.buyingRole || ''} |
| **Key Goals** | ${stakeholder.keyGoals || ''} |
| **Challenges & Pains** | ${stakeholder.challenges || ''} |
| **Discovery Question** | *${discoveryQuestion}* |
| **Enablement Artifact** | ${stakeholder.enablementArtifact || 'Not specified'} |

`;
                                        });

                                        markdown += `
---

## 3. Action Plan Summary

**Next Steps:**
1. Use the discovery questions above to validate your assumptions about each stakeholder
2. Create the specified enablement artifacts to arm your champion
3. Practice your champion enablement conversation using this map as a guide
4. Track which artifacts are most effective for future deals

**Key Metrics to Track:**
- Champion confidence level (1-10 scale)
- Stakeholder objections successfully addressed
- Timeline acceleration from enablement artifacts
- Deal progression velocity improvements

---

*Remember: 83% of the buying process happens when you're not in the room. Your success depends on how well you enable your champion to sell on your behalf.*`;

                                        return markdown;
                                    })()}
                                />
                                
                                <div className="flex justify-between items-center">
                                    <div className="text-sm text-gray-500">
                                        Ready to copy and share with your team
                                    </div>
                                    <button
                                        onClick={() => {
                                            const copyToClipboard = async (text) => {
                                                try {
                                                    if (navigator.clipboard && navigator.clipboard.writeText) {
                                                        await navigator.clipboard.writeText(text);
                                                        return true;
                                                    } else {
                                                        const textArea = document.createElement('textarea');
                                                        textArea.value = text;
                                                        textArea.style.position = 'fixed';
                                                        textArea.style.left = '-999999px';
                                                        document.body.appendChild(textArea);
                                                        textArea.select();
                                                        const successful = document.execCommand('copy');
                                                        document.body.removeChild(textArea);
                                                        return successful;
                                                    }
                                                } catch (err) {
                                                    return false;
                                                }
                                            };

                                            const el = document.getElementById('markdownSummary');
                                            const statusDiv = document.getElementById('copyStatus');
                                            
                                            copyToClipboard(el.value).then((success) => {
                                                if (success) {
                                                    // Show success status
                                                    if (statusDiv) {
                                                        statusDiv.innerHTML = `
                                                            <div class="mt-2 bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded-lg">
                                                                <p class="font-medium">✅ Copied to Clipboard!</p>
                                                                <p class="text-sm mt-1">Now paste in Google Docs: <strong>Edit → Paste special → Paste from markdown</strong></p>
                                                            </div>
                                                        `;
                                                    }
                                                    
                                                    // Floating notification
                                                    const notification = document.createElement('div');
                                                    notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #22c55e; color: white; padding: 16px 24px; border-radius: 8px; z-index: 9999; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;';
                                                    notification.textContent = '✅ Stakeholder map copied!';
                                                    document.body.appendChild(notification);
                                                    
                                                    setTimeout(() => {
                                                        notification.style.transition = 'opacity 0.5s';
                                                        notification.style.opacity = '0';
                                                        setTimeout(() => notification.remove(), 500);
                                                    }, 2500);
                                                }
                                            });
                                        }}
                                        className="bg-green-500 text-white px-6 py-2 rounded-lg font-medium hover:bg-green-600 transition-colors"
                                    >
                                        📋 Copy Summary
                                    </button>
                                </div>
                                
                                <div id="copyStatus"></div>
                            </div>
                        )}

                        {/* Navigation */}
                        <div className="flex justify-between items-center mt-6">
                            <button 
                                onClick={goToPreviousStep}
                                disabled={currentStep === 1}
                                className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                    currentStep === 1 
                                        ? 'bg-gray-200 text-gray-400 cursor-not-allowed' 
                                        : 'bg-gray-500 text-white hover:bg-gray-600'
                                }`}
                            >
                                ← Back
                            </button>

                            <button 
                                onClick={resetAllActivities} 
                                className="bg-red-500 text-white px-4 py-2 text-sm rounded-lg font-medium hover:bg-red-600 transition-colors"
                            >
                                Reset Workshop
                            </button>

                            <button
                                onClick={() => {
                                    if (currentStep === 3 && activity3Complete) {
                                        // Scroll to markdown export section
                                        const exportSection = document.getElementById('markdownExport');
                                        if (exportSection) {
                                            exportSection.scrollIntoView({ behavior: 'smooth' });
                                        }
                                    } else {
                                        goToNextStep();
                                    }
                                }}
                                disabled={
                                    (currentStep === 1 && !activity1Complete) ||
                                    (currentStep === 2 && !activity2Complete) ||
                                    (currentStep === 3 && !activity3Complete)
                                }
                                className={`px-6 py-2 rounded-lg font-medium transition-colors ${
                                    (currentStep === 1 && !activity1Complete) ||
                                    (currentStep === 2 && !activity2Complete) ||
                                    (currentStep === 3 && !activity3Complete)
                                        ? 'bg-gray-200 text-gray-400 cursor-not-allowed' 
                                        : (currentStep === 3 && activity3Complete) 
                                            ? 'bg-green-500 text-white hover:bg-green-600'
                                            : 'bg-orange-500 text-white hover:bg-orange-600'
                                }`}
                            >
                                {currentStep === 3 && activity3Complete ? 'View Summary ↓' : currentStep === 3 ? 'Workshop Complete' : 'Continue →'}
                            </button>
                        </div>

                        <footer className="max-w-6xl mx-auto text-center text-xs text-gray-500 mt-12 pb-8">
                            <p>
                                <strong>Note:</strong> Your progress is automatically saved in this browser's local storage. This data is private to your computer and is not sent to any server.
                            </p>
                            <p className="font-semibold mt-1">
                                ⚠️ Important: Do not clear your browser data before copying your final summary, as all your work will be permanently deleted.
                            </p>
                        </footer>
                        
                        {/* Bottom Navigation Buttons */}
                        <div className="max-w-[900px] mx-auto px-4 pb-8">
                            <div className="flex justify-between items-center">
                                <a 
                                    href="index.html" 
                                    className="bg-gray-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors inline-flex items-center"
                                >
                                    ← Back to Workshop
                                </a>
                                <a 
                                    href="../index.html" 
                                    className="bg-gray-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors inline-flex items-center"
                                >
                                    All GTM Workshops ↑
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Render the app using React 18 createRoot API
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<StakeholderMapWorkshop />);
    </script>
</body>
</html>