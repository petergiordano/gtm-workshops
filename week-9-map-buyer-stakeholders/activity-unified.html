<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Buyer Stakeholders Workshop</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Raleway:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Open Sans', 'Raleway', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #fafafa;
            margin: 0;
            padding: 0;
        }
        .laptop-textarea {
            min-height: 80px;
            max-height: 120px;
            transition: max-height 0.3s ease;
            resize: none;
        }
        .laptop-textarea:focus {
            max-height: 200px;
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .step-icon {
            width: 48px;
            height: 48px;
            background-color: #FF9000;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            flex-shrink: 0;
        }
        input::placeholder {
            color: #9CA3AF;
        }
        @media (max-width: 768px) {
            .fields-grid {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Test Data from TODO.md specifications -->
    <script type="application/json" id="testData">
    {
        "selectedBuyingJobs": ["Consensus Creation", "Validation", "Supplier Selection"],
        "buyingJobsJustification": "Our ICP struggles most with getting their multiple departments (Engineering, Finance, Security) to agree on the need for a new tool, validating that a predictive solution will actually work, and selecting it over expanding their current tools.",
        "stakeholders": [
            {
                "functionalRole": "Head of DevOps",
                "stakeholderPersona": "End User",
                "keyGoals": "Reduce time spent firefighting reactive alerts. Prevent being woken up at 2 AM for P1 incidents. Improve system reliability and automate manual toil.",
                "challenges": "Constantly pulled away from strategic projects to fix outages. Alert fatigue from current tools is high. Lacks the ability to get ahead of problems before they impact customers."
            },
            {
                "functionalRole": "VP of Engineering",
                "stakeholderPersona": "Decision Maker",
                "keyGoals": "Improve team efficiency and focus on innovation. Link engineering reliability metrics (MTTR, MTBF) to business outcomes. Implement a resilient and scalable system architecture.",
                "challenges": "High operational costs due to engineering time spent on reactive problem-solving. Fragmented visibility across different platforms. Difficulty proving the business value of new infrastructure investments."
            },
            {
                "functionalRole": "Chief Financial Officer",
                "stakeholderPersona": "Economic Buyer",
                "keyGoals": "Justify all technology spend with clear ROI. Reduce financial risk associated with costly downtime. Ensure budget predictability and achieve cost savings.",
                "challenges": "API downtime is expensive ($100k+/hr), but it's a reactive, unpredictable cost. It's difficult to approve a new, proactive expense without a clear financial case showing it's cheaper than the current pain."
            },
            {
                "functionalRole": "Director of IT Security",
                "stakeholderPersona": "Blocker",
                "keyGoals": "Ensure all new vendors are SOC2 compliant. Prevent new tools from introducing security vulnerabilities. Maintain data integrity and governance across all systems.",
                "challenges": "Every new tool is a potential security risk. The vendor onboarding process is long and requires extensive documentation on data handling, security, and compliance."
            }
        ],
        "prescriptions": [
            {
                "targetStakeholder": "Chief Financial Officer",
                "primaryBarrier": "Believes existing monitoring tools are a 'good enough' sunk cost and doesn't see a clear financial case for a new, premium-priced predictive solution.",
                "enablementArtifact": "Provide our champion (VP of Eng) with a 1-page ROI model and a business case template. It will quantify the cost of their last 3 major outages and project a 6-month payback period for Posh AMP."
            },
            {
                "targetStakeholder": "Director of IT Security",
                "primaryBarrier": "Concerned that our platform will require excessive permissions and access to sensitive data, posing a security risk.",
                "enablementArtifact": "Create a 'Security & Compliance Packet' for our champion to share. It will include our SOC2 Type II report, a data processing agreement, and a technical brief on our platform's security architecture and minimal data access requirements."
            }
        ],
        "currentStep": 3
    }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // Global constants and helper functions
        const WORKSHOP_STORAGE_KEY = 'workshopState_buyer_stakeholders';

        /**
         * Loads the entire workshop state from localStorage using a specific key.
         * @param {string} storageKey - The unique key for the workshop's state.
         * @returns {object} The parsed workshop state or an empty object.
         */
        const loadWorkshopState = (storageKey) => {
            try {
                const savedState = localStorage.getItem(storageKey);
                return savedState ? JSON.parse(savedState) : {};
            } catch (error) {
                console.error("Could not load state from localStorage", error);
                return {};
            }
        };

        /**
         * Saves a piece of state by merging it into the existing workshop state.
         * @param {object} stateToSave - An object containing the key-value pairs to save.
         * @param {string} storageKey - The unique key for the workshop's state.
         */
        const saveWorkshopState = (stateToSave, storageKey) => {
            try {
                const currentState = loadWorkshopState(storageKey);
                const newState = { ...currentState, ...stateToSave };
                localStorage.setItem(storageKey, JSON.stringify(newState));
            } catch (error) {
                console.error("Could not save state to localStorage", error);
            }
        };

        // Helper function for word count feedback
        const WordCountFeedback = ({ text, minWords = 5 }) => {
            const wordCount = text.trim().split(/\s+/).filter(w => w.length > 0).length;
            const isValid = wordCount >= minWords;
            
            return (
                <div className="flex justify-between items-center mt-1">
                    <span className="text-xs text-gray-500">
                        (describe in {minWords}+ words)
                    </span>
                    <span className={`text-sm flex items-center gap-1 ${isValid ? 'text-green-600' : 'text-gray-500'}`}>
                        {wordCount} words
                        {isValid && <span>✓</span>}
                    </span>
                </div>
            );
        };

        const PrivacyNote = () => (
            <div className="bg-blue-50 border border-blue-200 text-blue-800 text-xs rounded-lg p-3 my-4">
                <p>
                    <strong>Note:</strong> Your progress is automatically saved in this browser's local storage. This data is private to your computer and is not sent to any server.
                </p>
            </div>
        );

        // StepIndicator component with completion status
        const StepIndicator = ({ currentStep, activity1Complete, activity2Complete, activity3Complete }) => {
            const steps = [
                { number: 1, title: "Map Buying Jobs", desc: "Identify the most difficult buying jobs", complete: activity1Complete },
                { number: 2, title: "Assign Personas", desc: "Map stakeholders to roles", complete: activity2Complete },
                { number: 3, title: "Enablement Plan", desc: "Create buyer prescriptions", complete: activity3Complete }
            ];

            return (
                <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                    <div className="flex justify-between items-center">
                        {steps.map((step, index) => (
                            <React.Fragment key={step.number}>
                                <div className="flex items-center">
                                    <div className={`step-icon ${
                                        step.complete ? 'bg-green-500' : 
                                        currentStep >= step.number ? 'bg-orange-500' : 'bg-gray-400'
                                    }`}>
                                        {step.complete ? '✓' : step.number}
                                    </div>
                                    <div className="ml-3">
                                        <p className="text-sm font-medium text-gray-900">{step.title}</p>
                                        <p className="text-xs text-gray-500">{step.desc}</p>
                                    </div>
                                </div>
                                {index < steps.length - 1 && (
                                    <div className="flex-1 mx-4 h-px bg-gray-300"></div>
                                )}
                            </React.Fragment>
                        ))}
                    </div>
                </div>
            );
        };

        const StakeholderMapWorkshop = () => {
            // Navigation state
            const [currentStep, setCurrentStep] = useState(() => {
                const urlStep = new URLSearchParams(window.location.search).get('step');
                if (urlStep && [1, 2, 3].includes(parseInt(urlStep))) {
                    return parseInt(urlStep);
                }
                const saved = loadWorkshopState(WORKSHOP_STORAGE_KEY);
                return saved.currentStep || 1;
            });

            // Dev mode functionality
            const [devMode, setDevMode] = useState(false);
            const [devFillLoading, setDevFillLoading] = useState(false);

            // Toggle dev mode
            const toggleDevMode = () => {
                setDevMode(!devMode);
                console.log(devMode ? '🔒 Dev mode disabled' : '🔓 Dev mode enabled');
            };

            // Load test data
            const devFillData = () => {
                setDevFillLoading(true);
                try {
                    const testData = JSON.parse(document.getElementById('testData').textContent);
                    
                    // Activity 1 state variables
                    setSelectedBuyingJobs(testData.selectedBuyingJobs || []);
                    setBuyingJobsJustification(testData.buyingJobsJustification || '');
                    
                    // Activity 2 state variables
                    setStakeholders(testData.stakeholders || []);
                    
                    // Activity 3 state variables
                    setPrescriptions(testData.prescriptions || []);
                    
                    // Set current step
                    setCurrentStep(testData.currentStep || 3);
                    
                    console.log('✅ Dev data loaded successfully');
                } catch (error) {
                    console.error('❌ Failed to load dev data:', error);
                } finally {
                    setDevFillLoading(false);
                }
            };

            // Initialize all state variables from localStorage
            const savedState = loadWorkshopState(WORKSHOP_STORAGE_KEY);
            
            // Activity 1: Map the Buying Jobs
            const [selectedBuyingJobs, setSelectedBuyingJobs] = useState(savedState.selectedBuyingJobs || []);
            const [buyingJobsJustification, setBuyingJobsJustification] = useState(savedState.buyingJobsJustification || '');
            
            // Activity 2: Assign Personas to Roles (Dynamic array of stakeholders)
            const [stakeholders, setStakeholders] = useState(savedState.stakeholders || []);
            
            // Activity 3: Develop a Buyer Enablement Plan (Dynamic array of prescriptions)
            const [prescriptions, setPrescriptions] = useState(savedState.prescriptions || []);

            // Activity completion logic
            const activity1Complete = useMemo(() => {
                return selectedBuyingJobs.length >= 2 && selectedBuyingJobs.length <= 3 && 
                       buyingJobsJustification.trim().split(/\s+/).filter(w => w.length > 0).length >= 15;
            }, [selectedBuyingJobs, buyingJobsJustification]);
            
            const activity2Complete = useMemo(() => {
                return stakeholders.length >= 3 && stakeholders.every(s => 
                    s.functionalRole && s.functionalRole.trim().split(/\s+/).filter(w => w.length > 0).length >= 3 &&
                    s.stakeholderPersona &&
                    s.keyGoals && s.keyGoals.trim().split(/\s+/).filter(w => w.length > 0).length >= 10 &&
                    s.challenges && s.challenges.trim().split(/\s+/).filter(w => w.length > 0).length >= 10
                );
            }, [stakeholders]);
            
            const activity3Complete = useMemo(() => {
                return prescriptions.length >= 2 && prescriptions.every(p =>
                    p.targetStakeholder &&
                    p.primaryBarrier && p.primaryBarrier.trim().split(/\s+/).filter(w => w.length > 0).length >= 10 &&
                    p.enablementArtifact && p.enablementArtifact.trim().split(/\s+/).filter(w => w.length > 0).length >= 10
                );
            }, [prescriptions]);

            // Auto-save state to localStorage whenever any form data changes
            useEffect(() => {
                const currentState = {
                    selectedBuyingJobs,
                    buyingJobsJustification,
                    stakeholders,
                    prescriptions,
                    currentStep
                };
                saveWorkshopState(currentState, WORKSHOP_STORAGE_KEY);
            }, [selectedBuyingJobs, buyingJobsJustification, stakeholders, prescriptions, currentStep]);

            // Navigation functions
            const goToNextStep = () => {
                const nextStep = Math.min(currentStep + 1, 3);
                setCurrentStep(nextStep);
                saveWorkshopState({ currentStep: nextStep }, WORKSHOP_STORAGE_KEY);
            };

            const goToPreviousStep = () => {
                const prevStep = Math.max(currentStep - 1, 1);
                setCurrentStep(prevStep);
                saveWorkshopState({ currentStep: prevStep }, WORKSHOP_STORAGE_KEY);
            };

            const resetAllActivities = () => {
                if (confirm('Are you sure you want to reset all your progress? This cannot be undone.')) {
                    // Clear component state
                    setSelectedBuyingJobs([]);
                    setBuyingJobsJustification('');
                    setStakeholders([]);
                    setPrescriptions([]);
                    setCurrentStep(1);
                    
                    // Clear localStorage data
                    const emptyState = {
                        selectedBuyingJobs: [],
                        buyingJobsJustification: '',
                        stakeholders: [],
                        prescriptions: [],
                        currentStep: 1
                    };
                    saveWorkshopState(emptyState, WORKSHOP_STORAGE_KEY);
                }
            };

            return (
                <div className="bg-gray-50 min-h-screen">
                    <div className="max-w-[900px] mx-auto p-4">
                        {/* Header */}
                        <div className="flex justify-between items-center w-full mb-2">
                            <a href="index.html" className="text-orange-500 hover:text-orange-600">← Back to Workshop</a>
                            <a href="../index.html" className="text-orange-500 hover:text-orange-600">All GTM Workshops ↑</a>
                        </div>

                        {/* Title with dev mode toggle */}
                        <h1 
                            className={`text-xl font-bold text-gray-800 ${devMode ? 'text-orange-600' : ''} cursor-pointer select-none mb-4`}
                            onDoubleClick={toggleDevMode}
                            title="Double-click to toggle dev mode"
                        >
                            Map Buyer Stakeholders Workshop {devMode && '🔧'}
                        </h1>

                        {/* Dev mode controls */}
                        {devMode && (
                            <div className="mt-3 pt-3 border-t border-orange-200 mb-4">
                                <div className="flex items-center justify-between">
                                    <span className="text-xs text-orange-600 font-medium">🔧 Dev Mode Active</span>
                                    <button
                                        onClick={devFillData}
                                        disabled={devFillLoading}
                                        className="bg-orange-500 text-white px-3 py-1 rounded text-xs hover:bg-orange-600"
                                    >
                                        {devFillLoading ? '⏳ Loading...' : '📝 Fill Test Data'}
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Step Indicator */}
                        <StepIndicator 
                            currentStep={currentStep}
                            activity1Complete={activity1Complete}
                            activity2Complete={activity2Complete}
                            activity3Complete={activity3Complete}
                        />

                        <PrivacyNote />

                        {/* Activity Content */}
                        <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                            {currentStep === 1 && (
                                <div className="animate-fadeIn">
                                    <h2 className="text-xl font-bold text-gray-800 mb-4">
                                        Activity 1: Map the Buying Jobs
                                    </h2>
                                    <p className="text-gray-600 mb-6">
                                        The B2B buying process isn't a simple funnel; it's a complex journey where customers must complete six distinct "jobs" to reach a decision. In this activity, you will analyze your customer's journey to identify the 2-3 jobs that are the most difficult or create the most friction. This crucial first step forces you to see the deal from your customer's perspective and identifies the exact points of leverage where your sales process can add the most value.
                                    </p>
                                    
                                    {/* Buying Jobs Selection */}
                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-gray-700 mb-3">
                                            Select the top 2-3 most difficult buying jobs:
                                            <span className="text-red-500">*</span>
                                        </label>
                                        <p className="text-xs text-gray-500 mb-4">Choose the jobs where your customer's buying process most often stalls or breaks down.</p>
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                            {[
                                                'Problem Identification',
                                                'Solution Exploration', 
                                                'Requirements Building',
                                                'Supplier Selection',
                                                'Validation',
                                                'Consensus Creation'
                                            ].map((job) => (
                                                <div key={job} className="flex items-center">
                                                    <input
                                                        type="checkbox"
                                                        id={job}
                                                        checked={selectedBuyingJobs.includes(job)}
                                                        onChange={(e) => {
                                                            if (e.target.checked) {
                                                                if (selectedBuyingJobs.length < 3) {
                                                                    setSelectedBuyingJobs([...selectedBuyingJobs, job]);
                                                                }
                                                            } else {
                                                                setSelectedBuyingJobs(selectedBuyingJobs.filter(j => j !== job));
                                                            }
                                                        }}
                                                        className="h-4 w-4 text-orange-500 focus:ring-orange-500 border-gray-300 rounded"
                                                        disabled={!selectedBuyingJobs.includes(job) && selectedBuyingJobs.length >= 3}
                                                    />
                                                    <label htmlFor={job} className="ml-2 text-sm text-gray-700">
                                                        {job}
                                                    </label>
                                                </div>
                                            ))}
                                        </div>
                                        
                                        <div className="mt-2 text-sm">
                                            <span className={selectedBuyingJobs.length >= 2 && selectedBuyingJobs.length <= 3 ? 'text-green-600' : 'text-gray-500'}>
                                                {selectedBuyingJobs.length} of 2-3 selected
                                                {selectedBuyingJobs.length >= 2 && selectedBuyingJobs.length <= 3 && <span className="ml-1">✓</span>}
                                            </span>
                                        </div>
                                    </div>

                                    {/* Buying Jobs Justification */}
                                    <div className="mb-6">
                                        <label htmlFor="buyingJobsJustification" className="block text-sm font-medium text-gray-700 mb-2">
                                            Why are these jobs the most difficult for your customer?
                                            <span className="text-red-500">*</span>
                                        </label>
                                        <textarea
                                            id="buyingJobsJustification"
                                            value={buyingJobsJustification}
                                            onChange={(e) => setBuyingJobsJustification(e.target.value)}
                                            placeholder="e.g., Our customers struggle most with Consensus Creation because the purchase involves three departments (Engineering, Finance, Security) with conflicting priorities. Getting them to agree on a budget and a timeline is where deals stall."
                                            className="laptop-textarea w-full p-3 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none"
                                        />
                                        <WordCountFeedback text={buyingJobsJustification} minWords={15} />
                                        <p className="text-xs text-gray-500 mt-1">
                                            Think about where your deals get stuck. Is it identifying the problem, or getting 10 stakeholders to agree? This is the friction your sales process must solve.
                                        </p>
                                    </div>
                                </div>
                            )}

                            {currentStep === 2 && (
                                <div className="animate-fadeIn">
                                    <h2 className="text-xl font-bold text-gray-800 mb-4">
                                        Activity 2: Assign Personas to Roles
                                    </h2>
                                    <p className="text-gray-600 mb-6">
                                        You are never selling to one person; you are selling to a committee of 6-10 people with different motivations and priorities. This activity moves beyond simple org charts to build a sophisticated stakeholder map. You will identify the key players, distinguish their company role from their "buying persona" (e.g., Champion, Blocker, Economic Buyer), and articulate the specific goals and challenges that drive their decision-making process.
                                    </p>
                                    
                                    {/* Stakeholders Array */}
                                    <div className="mb-6">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-lg font-medium text-gray-800">
                                                Key Stakeholders ({stakeholders.length})
                                                <span className="text-red-500">*</span>
                                            </h3>
                                            <button
                                                onClick={() => {
                                                    const newStakeholder = {
                                                        functionalRole: '',
                                                        stakeholderPersona: '',
                                                        keyGoals: '',
                                                        challenges: ''
                                                    };
                                                    setStakeholders([...stakeholders, newStakeholder]);
                                                }}
                                                className="bg-orange-500 text-white px-3 py-1 text-sm rounded-lg hover:bg-orange-600 transition-colors"
                                            >
                                                + Add Stakeholder
                                            </button>
                                        </div>
                                        
                                        <p className="text-xs text-gray-500 mb-4">Add 3-5 key players in the buying committee.</p>
                                        
                                        {stakeholders.map((stakeholder, index) => (
                                            <div key={index} className="border border-gray-200 rounded-lg p-4 mb-4 bg-gray-50">
                                                <div className="flex justify-between items-center mb-3">
                                                    <h4 className="font-medium text-gray-700">Stakeholder {index + 1}</h4>
                                                    <button
                                                        onClick={() => {
                                                            setStakeholders(stakeholders.filter((_, i) => i !== index));
                                                        }}
                                                        className="text-red-500 hover:text-red-700 text-sm"
                                                    >
                                                        Remove
                                                    </button>
                                                </div>
                                                
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                                                    {/* Functional Role */}
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                            Functional Role <span className="text-red-500">*</span>
                                                        </label>
                                                        <input
                                                            type="text"
                                                            value={stakeholder.functionalRole}
                                                            onChange={(e) => {
                                                                const updated = [...stakeholders];
                                                                updated[index].functionalRole = e.target.value;
                                                                setStakeholders(updated);
                                                            }}
                                                            placeholder="e.g., Head of DevOps"
                                                            className="w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                                        />
                                                        <p className="text-xs text-gray-500 mt-1">The person's function, not their specific title</p>
                                                    </div>
                                                    
                                                    {/* Stakeholder Persona */}
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                            Buying Persona <span className="text-red-500">*</span>
                                                        </label>
                                                        <select
                                                            value={stakeholder.stakeholderPersona}
                                                            onChange={(e) => {
                                                                const updated = [...stakeholders];
                                                                updated[index].stakeholderPersona = e.target.value;
                                                                setStakeholders(updated);
                                                            }}
                                                            className="w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                                        >
                                                            <option value="">Select persona...</option>
                                                            <option value="Champion">Champion</option>
                                                            <option value="Economic Buyer">Economic Buyer</option>
                                                            <option value="Technical Buyer">Technical Buyer</option>
                                                            <option value="Decision Maker">Decision Maker</option>
                                                            <option value="End User">End User</option>
                                                            <option value="Blocker">Blocker</option>
                                                            <option value="Influencer">Influencer</option>
                                                        </select>
                                                        <p className="text-xs text-gray-500 mt-1">Role in this specific purchase decision</p>
                                                    </div>
                                                </div>
                                                
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    {/* Key Goals */}
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                            Key Goals & Motivations <span className="text-red-500">*</span>
                                                        </label>
                                                        <textarea
                                                            value={stakeholder.keyGoals}
                                                            onChange={(e) => {
                                                                const updated = [...stakeholders];
                                                                updated[index].keyGoals = e.target.value;
                                                                setStakeholders(updated);
                                                            }}
                                                            placeholder="e.g., Reduce P1 incidents by 50%, improve team efficiency, link engineering metrics to business outcomes."
                                                            className="laptop-textarea w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none"
                                                        />
                                                        <WordCountFeedback text={stakeholder.keyGoals} minWords={10} />
                                                        <p className="text-xs text-gray-500 mt-1">Use the buyer's language, focus on business outcomes</p>
                                                    </div>
                                                    
                                                    {/* Challenges */}
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                            Challenges & Pains <span className="text-red-500">*</span>
                                                        </label>
                                                        <textarea
                                                            value={stakeholder.challenges}
                                                            onChange={(e) => {
                                                                const updated = [...stakeholders];
                                                                updated[index].challenges = e.target.value;
                                                                setStakeholders(updated);
                                                            }}
                                                            placeholder="e.g., Spends 10+ hours a week firefighting reactive alerts. Constantly pulled away from core development to fix outages."
                                                            className="laptop-textarea w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none"
                                                        />
                                                        <WordCountFeedback text={stakeholder.challenges} minWords={10} />
                                                        <p className="text-xs text-gray-500 mt-1">Focus on pain points that can be tied to ROI</p>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                        
                                        {stakeholders.length === 0 && (
                                            <div className="text-center py-8 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg">
                                                <p>No stakeholders added yet.</p>
                                                <p className="text-sm mt-1">Click "Add Stakeholder" to get started.</p>
                                            </div>
                                        )}
                                        
                                        <div className="mt-2 text-sm">
                                            <span className={stakeholders.length >= 3 ? 'text-green-600' : 'text-gray-500'}>
                                                {stakeholders.length} of 3+ stakeholders required
                                                {stakeholders.length >= 3 && <span className="ml-1">✓</span>}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {currentStep === 3 && (
                                <div className="animate-fadeIn">
                                    <h2 className="text-xl font-bold text-gray-800 mb-4">
                                        Activity 3: Develop a Buyer Enablement Plan
                                    </h2>
                                    <p className="text-gray-600 mb-6">
                                        A staggering 83% of the buying process happens when you are not in the room. Your success depends on your ability to arm your internal champion to sell on your behalf. In this final activity, you will translate your stakeholder map into an actionable plan. You will create specific "prescriptions"—tangible assets like an ROI calculator or a security brief—designed to help your champion overcome objections and build consensus within the buying group.
                                    </p>
                                    
                                    {/* Prescriptions Array */}
                                    <div className="mb-6">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="text-lg font-medium text-gray-800">
                                                Buyer Enablement Prescriptions ({prescriptions.length})
                                                <span className="text-red-500">*</span>
                                            </h3>
                                            <button
                                                onClick={() => {
                                                    const newPrescription = {
                                                        targetStakeholder: '',
                                                        primaryBarrier: '',
                                                        enablementArtifact: ''
                                                    };
                                                    setPrescriptions([...prescriptions, newPrescription]);
                                                }}
                                                className="bg-orange-500 text-white px-3 py-1 text-sm rounded-lg hover:bg-orange-600 transition-colors"
                                            >
                                                + Add Prescription
                                            </button>
                                        </div>
                                        
                                        <p className="text-xs text-gray-500 mb-4">Add at least 2 specific 'prescriptions' to arm your champion.</p>
                                        
                                        {prescriptions.map((prescription, index) => (
                                            <div key={index} className="border border-gray-200 rounded-lg p-4 mb-4 bg-gray-50">
                                                <div className="flex justify-between items-center mb-3">
                                                    <h4 className="font-medium text-gray-700">Prescription {index + 1}</h4>
                                                    <button
                                                        onClick={() => {
                                                            setPrescriptions(prescriptions.filter((_, i) => i !== index));
                                                        }}
                                                        className="text-red-500 hover:text-red-700 text-sm"
                                                    >
                                                        Remove
                                                    </button>
                                                </div>
                                                
                                                {/* Target Stakeholder Dropdown */}
                                                <div className="mb-4">
                                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                                        Target Stakeholder <span className="text-red-500">*</span>
                                                    </label>
                                                    <select
                                                        value={prescription.targetStakeholder}
                                                        onChange={(e) => {
                                                            const updated = [...prescriptions];
                                                            updated[index].targetStakeholder = e.target.value;
                                                            setPrescriptions(updated);
                                                        }}
                                                        className="w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                                    >
                                                        <option value="">Select stakeholder...</option>
                                                        {stakeholders.map((stakeholder, idx) => (
                                                            <option key={idx} value={stakeholder.functionalRole}>
                                                                {stakeholder.functionalRole} {stakeholder.stakeholderPersona && `(${stakeholder.stakeholderPersona})`}
                                                            </option>
                                                        ))}
                                                    </select>
                                                    <p className="text-xs text-gray-500 mt-1">Who does your champion need to convince? This list is pulled from Activity 2.</p>
                                                    {stakeholders.length === 0 && (
                                                        <p className="text-xs text-orange-600 mt-1">⚠️ Complete Activity 2 first to populate stakeholder options.</p>
                                                    )}
                                                </div>
                                                
                                                <div className="grid grid-cols-1 gap-4">
                                                    {/* Primary Barrier */}
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                            Primary Barrier / Objection <span className="text-red-500">*</span>
                                                        </label>
                                                        <textarea
                                                            value={prescription.primaryBarrier}
                                                            onChange={(e) => {
                                                                const updated = [...prescriptions];
                                                                updated[index].primaryBarrier = e.target.value;
                                                                setPrescriptions(updated);
                                                            }}
                                                            placeholder="e.g., The CFO believes our existing monitoring tools are 'good enough' and doesn't see the ROI of a predictive solution."
                                                            className="laptop-textarea w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none"
                                                        />
                                                        <WordCountFeedback text={prescription.primaryBarrier} minWords={10} />
                                                        <p className="text-xs text-gray-500 mt-1">What is the single biggest reason this person would say 'no' or delay the deal?</p>
                                                    </div>
                                                    
                                                    {/* Enablement Artifact */}
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                                            Enablement Artifact (Your 'Prescription') <span className="text-red-500">*</span>
                                                        </label>
                                                        <textarea
                                                            value={prescription.enablementArtifact}
                                                            onChange={(e) => {
                                                                const updated = [...prescriptions];
                                                                updated[index].enablementArtifact = e.target.value;
                                                                setPrescriptions(updated);
                                                            }}
                                                            placeholder="e.g., A 1-page ROI calculator showing a 6-month payback period. Arm our champion with this for their budget meeting."
                                                            className="laptop-textarea w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none"
                                                        />
                                                        <WordCountFeedback text={prescription.enablementArtifact} minWords={10} />
                                                        <p className="text-xs text-gray-500 mt-1">What specific, tangible asset can you create to help your champion overcome this barrier?</p>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                        
                                        {prescriptions.length === 0 && (
                                            <div className="text-center py-8 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg">
                                                <p>No prescriptions added yet.</p>
                                                <p className="text-sm mt-1">Click "Add Prescription" to get started.</p>
                                            </div>
                                        )}
                                        
                                        <div className="mt-2 text-sm">
                                            <span className={prescriptions.length >= 2 ? 'text-green-600' : 'text-gray-500'}>
                                                {prescriptions.length} of 2+ prescriptions required
                                                {prescriptions.length >= 2 && <span className="ml-1">✓</span>}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Markdown Export - Show when workshop is complete */}
                        {activity1Complete && activity2Complete && activity3Complete && (
                            <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">
                                    📋 Your Buyer Stakeholder Map & Enablement Plan
                                </h2>
                                <p className="text-gray-600 mb-4">
                                    Congratulations! Your stakeholder mapping workshop is complete. Copy the summary below to share with your team or paste into Google Docs.
                                </p>
                                
                                <textarea
                                    id="markdownSummary"
                                    readOnly
                                    className="w-full h-64 text-sm p-3 font-mono border border-gray-200 rounded-lg bg-gray-50 resize-none mb-3"
                                    value={(() => {
                                        let markdown = `# Buyer Stakeholder Map & Enablement Plan

*This document outlines the key stakeholders, buying jobs, and a strategic enablement plan for a target customer account. Generated via the GTM Workshop.*

---

## 1. Critical Buying Jobs Analysis

**The ${selectedBuyingJobs.length} most difficult buying jobs for our customer are:**
${selectedBuyingJobs.map(job => `- ${job}`).join('\n')}

**Justification:**
${buyingJobsJustification}

---

## 2. The Stakeholder Map
`;

                                        stakeholders.forEach((stakeholder, index) => {
                                            markdown += `
### **Stakeholder ${index + 1}: ${stakeholder.functionalRole}**
- **Persona:** ${stakeholder.stakeholderPersona}
- **Key Goals:** ${stakeholder.keyGoals}
- **Challenges:** ${stakeholder.challenges}
`;
                                        });

                                        markdown += `
---

## 3. Buyer Enablement Plan (Prescriptions)
`;

                                        prescriptions.forEach((prescription, index) => {
                                            markdown += `
### **Prescription ${index + 1}: For the ${prescription.targetStakeholder}**
- **Primary Barrier:** ${prescription.primaryBarrier}
- **Enablement Artifact:** ${prescription.enablementArtifact}
`;
                                        });

                                        return markdown;
                                    })()}
                                />
                                
                                <div className="flex justify-between items-center">
                                    <div className="text-sm text-gray-500">
                                        Ready to copy and share with your team
                                    </div>
                                    <button
                                        onClick={() => {
                                            const copyToClipboard = async (text) => {
                                                try {
                                                    if (navigator.clipboard && navigator.clipboard.writeText) {
                                                        await navigator.clipboard.writeText(text);
                                                        return true;
                                                    } else {
                                                        const textArea = document.createElement('textarea');
                                                        textArea.value = text;
                                                        textArea.style.position = 'fixed';
                                                        textArea.style.left = '-999999px';
                                                        document.body.appendChild(textArea);
                                                        textArea.select();
                                                        const successful = document.execCommand('copy');
                                                        document.body.removeChild(textArea);
                                                        return successful;
                                                    }
                                                } catch (err) {
                                                    return false;
                                                }
                                            };

                                            const el = document.getElementById('markdownSummary');
                                            const statusDiv = document.getElementById('copyStatus');
                                            
                                            copyToClipboard(el.value).then((success) => {
                                                if (success) {
                                                    // Show success status
                                                    if (statusDiv) {
                                                        statusDiv.innerHTML = `
                                                            <div class="mt-2 bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded-lg">
                                                                <p class="font-medium">✅ Copied to Clipboard!</p>
                                                                <p class="text-sm mt-1">Now paste in Google Docs: <strong>Edit → Paste special → Paste from markdown</strong></p>
                                                            </div>
                                                        `;
                                                    }
                                                    
                                                    // Floating notification
                                                    const notification = document.createElement('div');
                                                    notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #22c55e; color: white; padding: 16px 24px; border-radius: 8px; z-index: 9999; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;';
                                                    notification.textContent = '✅ Stakeholder map copied!';
                                                    document.body.appendChild(notification);
                                                    
                                                    setTimeout(() => {
                                                        notification.style.transition = 'opacity 0.5s';
                                                        notification.style.opacity = '0';
                                                        setTimeout(() => notification.remove(), 500);
                                                    }, 2500);
                                                }
                                            });
                                        }}
                                        className="bg-green-500 text-white px-6 py-2 rounded-lg font-medium hover:bg-green-600 transition-colors"
                                    >
                                        📋 Copy Summary
                                    </button>
                                </div>
                                
                                <div id="copyStatus"></div>
                            </div>
                        )}

                        {/* Navigation */}
                        <div className="flex justify-between items-center mt-6">
                            <button 
                                onClick={goToPreviousStep}
                                disabled={currentStep === 1}
                                className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                    currentStep === 1 
                                        ? 'bg-gray-200 text-gray-400 cursor-not-allowed' 
                                        : 'bg-gray-500 text-white hover:bg-gray-600'
                                }`}
                            >
                                ← Back
                            </button>

                            <button 
                                onClick={resetAllActivities} 
                                className="bg-red-500 text-white px-4 py-2 text-sm rounded-lg font-medium hover:bg-red-600 transition-colors"
                            >
                                Reset Workshop
                            </button>

                            <button
                                onClick={goToNextStep}
                                disabled={
                                    (currentStep === 1 && !activity1Complete) ||
                                    (currentStep === 2 && !activity2Complete) ||
                                    (currentStep === 3)
                                }
                                className={`px-6 py-2 rounded-lg font-medium transition-colors ${
                                    (currentStep === 1 && !activity1Complete) ||
                                    (currentStep === 2 && !activity2Complete) ||
                                    (currentStep === 3)
                                        ? 'bg-gray-200 text-gray-400 cursor-not-allowed' 
                                        : 'bg-orange-500 text-white hover:bg-orange-600'
                                }`}
                            >
                                {currentStep === 3 ? 'Workshop Complete' : 'Continue →'}
                            </button>
                        </div>

                        <footer className="max-w-6xl mx-auto text-center text-xs text-gray-500 mt-12 pb-8">
                            <p>
                                <strong>Note:</strong> Your progress is automatically saved in this browser's local storage. This data is private to your computer and is not sent to any server.
                            </p>
                            <p className="font-semibold mt-1">
                                ⚠️ Important: Do not clear your browser data before copying your final summary, as all your work will be permanently deleted.
                            </p>
                        </footer>
                    </div>
                </div>
            );
        };

        // Render the app using React 18 createRoot API
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<StakeholderMapWorkshop />);
    </script>
</body>
</html>